**DNS 协议**

`DNS` 的两项功能  
第一是根据名称查到具体的地址  
另外一个是可以针对多个地址做负载均衡 而且可以在多个地址中选择一个距离你近的地方访问

客户端会发出一个 `DNS` 请求 问 www.xxxx.xxx 的 IP 是啥啊  
发给本地域名服务器（本地DNS）  
本地 DNS 收到来做客户端的请求 这台服务器上缓存了一张域名与之对应 IP地址的大表格  
找到就返回 如果没有 本地DNS就回去问它的根域服务器  
根域名服务器是最高层次的 全球 13 台  不直接用于域名解析 但能指明一条道路  

根 DNS 收到来自本地 DNS 请求 发现后缀是 .com (.net .org) 这个域名是有 .com 区域管理  
我给你顶级域名服务器的地址 你去问它...  

本地 DNS 请求转向询问顶层域名服务器  老二 你能告诉我 www.xxxx.xxx 的 IP 地址么  
顶级域名服务器就是大名鼎鼎的比如 .com、.net、 .org 这些一级域名 它负责管理二级域名  
顶层域名服务器 会返回 权威 DNS 服务器的地址 

本地 DNS 请求又转向问 权威 DNS 服务器  查询之后将 IP 地址 告诉 本地 DNS  
本地 DNS 返回客户端  和目标建立连接

<img src="https://github.com/wangcongyi/test/blob/master/images/dns.jpg" > 

 

站在客户端角度 这是一次 DNS 递归查询过程 因为本地 DNS 全权为它效劳，它只要坐等结果即可  
在这个过程中，DNS 除了可以通过名称映射为 IP 地址，它还可以做另外一件事，就是负载均衡


#### HttpDNS  

- 传统的 DNS 有很多问题，例如解析慢、更新不及时 因为缓存、转发、NAT 问题导致客户端误会自己所在的位置和运营商，从而影响流量的调度  
- HttpDNS 通过客户端 SDK 和服务端，通过 HTTP 直接调用解析 DNS 的方式，绕过了传统 DNS 的这些缺点，实现了智能的调度





#### CDN  
上面的 DNS 是没有 CDN 的情况下  
有了 CDN 之后  在权威 DNS 服务器上会设置一个 CNAME 别名 指向另一个域名 www.xxxxcdn.com 返回给本地 DNS 服务器  
当本地 DNS 服务器拿到这个心域名时 是需要继续解析的 这个就是 CDN 自己的权威 DNS 服务器  
本地 DNS服务器会请求 CDN 全局负载均衡器解析域名：  
- 根据用户 IP 判断哪台服务器里用户最近  
- 根据用户所请求的 URL 中携带的内容名称 判断哪一台服务器上有用户所需内容  
- 查询各个服务器当前的负载情况 判断哪一台服务器有服务能力
基于以上这些条件 进行综合分析之后 全局负载均衡器会返回一台缓存服务器 IP 地址  
本地 DNS 服务器缓存这个 IP 地址 返回给客户端 客户端去访问这个边缘节点 下载资源
